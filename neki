from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options
import os
import time

def save_html_with_selenium(url, directory):
    # Set up Chrome options
    chrome_options = Options()
    chrome_options.add_argument("--headless")  # Run headless Chrome
    chrome_options.add_argument("--disable-gpu")
    chrome_options.add_argument("--no-sandbox")
    chrome_options.add_argument("--window-size=1920x1080")

    # Provide the path to the chromedriver executable
    chromedriver_path = '/path/to/chromedriver'  # Update this path

    # Set up the Chrome WebDriver
    service = Service(chromedriver_path)
    driver = webdriver.Chrome(service=service, options=chrome_options)
    
    try:
        # Open the main URL
        driver.get(url)
        
        # Wait for the page to load
        time.sleep(0)  # Adjust sleep time as needed

        # Find all the accommodation links
        accommodations = driver.find_elements(By.XPATH, "//a[contains(@class, 'sr_property_block_main_row')]")
        
        # Ensure the directory exists
        os.makedirs(directory, exist_ok=True)

        # Iterate through each accommodation link and save the HTML
        for index, accommodation in enumerate(accommodations):
            try:
                # Extract the link
                link = accommodation.get_attribute('href')
                
                # Open the accommodation link
                driver.get(link)
                
                # Wait for the page to load
                time.sleep(0)  # Adjust sleep time as needed
                
                # Get the fully rendered HTML
                html_content = driver.page_source
                
                # Save the HTML content to a file
                file_path = os.path.join(directory, f"accommodation_{index+1}.html")
                with open(file_path, 'w', encoding='utf-8') as file:
                    file.write(html_content)
                
                print(f"HTML content of accommodation {index+1} saved successfully.")
                
                # Go back to the main results page
                driver.back()
                time.sleep(0)  # Adjust sleep time as needed
            except Exception as e:
                print(f"An error occurred while processing accommodation {index+1}: {e}")
                
    finally:
        driver.quit()

# Example usage
url = "https://www.booking.com/searchresults.sl.html?ss=https://www.booking.com/searchresults.sl.html?ss=United+States&ssne=Kitajska&ssne_untouched=Kitajska&label=gen173nr-1FCAEoggI46AdIM1gEaMsBiAEBmAEjuAEXyAEM2AEB6AEB-AENiAIBqAIDuALNp7m1BsACAdICJDcwNDg2MDlkLTQwNjUtNGE2NC05OWY5LWM2NzRlYWQxMjM0Y9gCBuACAQ&sid=502bc2dc72ba5aab5a006c01e7ae66c8&aid=304142&lang=sl&sb=1&src_elem=sb&src=searchresults&dest_id=224&dest_type=country&ac_position=0&ac_click_type=b&ac_langcode=en&ac_suggestion_list_length=5&search_selected=true&search_pageview_id=e3f670a959f003c6&ac_meta=GhBlM2Y2NzBhOTU5ZjAwM2M2IAAoATICZW46A3VzYUAASgBQAA%3D%3D&checkin=2024-08-05&checkout=2024-08-06&ltfd=1%3A1%3A8-2024_6-2025%3A1%3A1&group_adults=2&no_rooms=1&group_children=0+States&ssne=Kitajska&ssne_untouched=Kitajska&label=gen173nr-1FCAEoggI46AdIM1gEaMsBiAEBmAEjuAEXyAEM2AEB6AEB-AENiAIBqAIDuALNp7m1BsACAdICJDcwNDg2MDlkLTQwNjUtNGE2NC05OWY5LWM2NzRlYWQxMjM0Y9gCBuACAQ&sid=502bc2dc72ba5aab5a006c01e7ae66c8&aid=304142&lang=sl&sb=1&src_elem=sb&src=searchresults&dest_id=224&dest_type=country&ac_position=0&ac_click_type=b&ac_langcode=en&ac_suggestion_list_length=5&search_selected=true&search_pageview_id=e3f670a959f003c6&ac_meta=GhBlM2Y2NzBhOTU5ZjAwM2M2IAAoATICZW46A3VzYUAASgBQAA%3D%3D&checkin=2024-08-05&checkout=2024-08-06&ltfd=1%3A1%3A8-2024_6-2025%3A1%3A1&group_adults=2&no_rooms=1&group_children=0"
directory = "hoteli"
save_html_with_selenium(url, directory)
